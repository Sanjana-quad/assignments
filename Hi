-- Step 1: Create the database
CREATE DATABASE Orders;
GO

-- Use the Orders database
USE Orders;
GO

-- Step 2: Create tables with constraints

-- tblCustomers table (Country default set to 'Canada')
CREATE TABLE tblCustomers (
    CustomerID INT PRIMARY KEY,
    CustomerName NVARCHAR(100),
    Country NVARCHAR(50) DEFAULT 'Canada'
);

-- tblSuppliers table
CREATE TABLE tblSuppliers (
    SupplierID INT PRIMARY KEY,
    SupplierName NVARCHAR(100)
);

-- tblShippers table (CompanyName must be unique)
CREATE TABLE tblShippers (
    ShipperID INT PRIMARY KEY,
    CompanyName NVARCHAR(100) UNIQUE
);

-- tblProducts table with foreign key referencing tblSuppliers
CREATE TABLE tblProducts (
    ProductID INT PRIMARY KEY,
    ProductName NVARCHAR(100),
    SupplierID INT,
    FOREIGN KEY (SupplierID) REFERENCES tblSuppliers(SupplierID)
);

-- tblOrders table with foreign key referencing tblCustomers and check constraint for ShippedDate > OrderDate
CREATE TABLE tblOrders (
    OrderID INT PRIMARY KEY,
    CustomerID INT,
    OrderDate DATE,
    ShippedDate DATE,
    FOREIGN KEY (CustomerID) REFERENCES tblCustomers(CustomerID),
    CHECK (ShippedDate > OrderDate)
);

-- tblOrderDetails table with foreign keys referencing tblOrders and tblProducts, and Quantity must be > 0
CREATE TABLE tblOrderDetails (
    OrderDetailID INT PRIMARY KEY,
    OrderID INT,
    ProductID INT,
    Quantity INT CHECK (Quantity > 0),
    FOREIGN KEY (OrderID) REFERENCES tblOrders(OrderID),
    FOREIGN KEY (ProductID) REFERENCES tblProducts(ProductID)
);

-- Step 3: Insert example data

-- Insert values into tblCustomers
INSERT INTO tblCustomers (CustomerID, CustomerName, Country)
VALUES 
(1, 'John Doe', 'USA'),
(2, 'Alice Smith', 'Canada'),
(3, 'Emma Brown', DEFAULT);  -- Uses default 'Canada'

-- Insert values into tblSuppliers
INSERT INTO tblSuppliers (SupplierID, SupplierName)
VALUES 
(1, 'Global Supplies'),
(2, 'Local Distributors'),
(3, 'Mega Corp');

-- Insert values into tblShippers
INSERT INTO tblShippers (ShipperID, CompanyName)
VALUES 
(1, 'Fast Delivery'),
(2, 'Express Logistics'),
(3, 'Safe Shippers');

-- Insert values into tblProducts
INSERT INTO tblProducts (ProductID, ProductName, SupplierID)
VALUES 
(1, 'Laptop', 1),
(2, 'Smartphone', 2),
(3, 'Tablet', 3);

-- Insert values into tblOrders
INSERT INTO tblOrders (OrderID, CustomerID, OrderDate, ShippedDate)
VALUES 
(1, 1, '2024-10-01', '2024-10-05'),
(2, 2, '2024-10-03', '2024-10-06'),
(3, 3, '2024-10-02', '2024-10-07');

-- Insert values into tblOrderDetails
INSERT INTO tblOrderDetails (OrderDetailID, OrderID, ProductID, Quantity)
VALUES 
(1, 1, 1, 5),  -- 5 Laptops
(2, 2, 2, 10), -- 10 Smartphones
(3, 3, 3, 2);  -- 2 Tablets
